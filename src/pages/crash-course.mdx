import { Player } from "../components/player";
import Footer from "../components/footer";
import Next from "../components/next";
import single from "../FPSound/CrashCourse/Single.purs";
import { main as singleMain } from "../../output/FPSound.CrashCourse.Single/";
import several from "../FPSound/CrashCourse/Several.purs";
import { main as severalMain } from "../../output/FPSound.CrashCourse.Several/";
import faster from "../FPSound/CrashCourse/Faster.purs";
import { main as fasterMain } from "../../output/FPSound.CrashCourse.Faster/";
import silence from "../FPSound/CrashCourse/Silence.purs";
import { main as silenceMain } from "../../output/FPSound.CrashCourse.Silence/";
import simul from "../FPSound/CrashCourse/Simul.purs";
import { main as simulMain } from "../../output/FPSound.CrashCourse.Simul/";
import subdiv from "../FPSound/CrashCourse/Subdiv.purs";
import { main as subdivMain } from "../../output/FPSound.CrashCourse.Subdiv/";
import branch from "../FPSound/CrashCourse/Branch.purs";
import { main as branchMain } from "../../output/FPSound.CrashCourse.Branch/";
import poly from "../FPSound/CrashCourse/Poly.purs";
import { main as polyMain } from "../../output/FPSound.CrashCourse.Poly/";
import voices from "../FPSound/CrashCourse/Voices.purs";
import { main as voicesMain } from "../../output/FPSound.CrashCourse.Voices/";
import drones from "../FPSound/CrashCourse/Drones.purs";
import { main as dronesMain } from "../../output/FPSound.CrashCourse.Drones/";
import volume from "../FPSound/CrashCourse/Volume.purs";
import { main as volumeMain } from "../../output/FPSound.CrashCourse.Volume/";
import rate from "../FPSound/CrashCourse/Rate.purs";
import { main as rateMain } from "../../output/FPSound.CrashCourse.Rate/";
import sounds from "../FPSound/CrashCourse/Sounds.purs";
import { main as soundsMain } from "../../output/FPSound.CrashCourse.Sounds/";
import foft from "../FPSound/CrashCourse/FofT.purs";
import { main as foftMain } from "../../output/FPSound.CrashCourse.FofT/";
import highpass from "../FPSound/CrashCourse/Highpass.purs";
import { main as highpassMain } from "../../output/FPSound.CrashCourse.Highpass/";
import pan from "../FPSound/CrashCourse/Pan.purs";
import { main as panMain } from "../../output/FPSound.CrashCourse.Pan/";
import sines from "../FPSound/CrashCourse/Sines.purs";
import { main as sinesMain } from "../../output/FPSound.CrashCourse.Sines/";
import feedback from "../FPSound/CrashCourse/Feedback.purs";
import { main as feedbackMain } from "../../output/FPSound.CrashCourse.Feedback/";
import { FontAwesomeIcon } from "@fortawesome/react-fontawesome";
import { faPlayCircle, faStopCircle } from "@fortawesome/free-solid-svg-icons";

# A Crash Course on Wags

This page is a crash course for [`purescript-wags`](https://github.com/mikesol/purescript-wags), the web audio library that powers [`wags.fm`](https://github.com/mikesol/wags.fm) and [`wagsi`](https://github.com/mikesol/wagsi).

## A single hi-hat

Let's start with a single hi-hat.

<Player player={singleMain} code={single} />

To listen to this and all other examples, click or press the **Play** <FontAwesomeIcon icon={faPlayCircle} /> button below the player.

Wags is written in [PureScript](https://purescript.org), but you don't need to know PureScript in order to use wags. In the example above, change `hh:0` to `bd:0` (bass drum), stop it, and start it again. Change it to `realclaps:0` (clap), stop it, and start it again. You can change to any of the sounds from the [Amazing SuperDirt Sample Library](https://github.com/mikesol/wagsi/blob/main/SOUNDS.md). Much of the Wags syntax is heavily inspired by [Tidal Cycles](https://tidalcycles.org/), so if you know Tidal, you should feel at home.

If you're coming from [wags.fm](https://wags.fm), you can copy this and all other examples into the _blank slate_ track and they will work out of the box.

## More samples

When you add more samples like `bd:0` or `hh:0` to the string, they are played in series.  The example below has four different samples. Try adding and removing some to see what happens.

<Player player={severalMain} code={several} />

## Faster loops

Let's make our loop faster. The example below is the same as the one above but plays at twice the speed. This is because the first value passed to `make` is `0.4`, or half of the value used above.

<Player player={fasterMain} code={faster} />

## Silence

Silence is golden! Use a tidla (`~`) to add silence in place of a note.

<Player player={silenceMain} code={silence} />

## Simultaneous samples

Sometimes, you want two samples to play at the same time. You can do this by putting square brackets (`[` and `]`) around them and separating them with a comma. More than two samples? No problem, just add more commas.

In the example below, we use three quotation marks to open and close a multiline string.

<Player player={simulMain} code={simul} />

## Subdivisions

To create internal subdivisions like 16th-notes (aka semiquavers), use square brackets (`[` and `]`) without a comma. You can also use an asterisk (`*`) to create subdivisions of a single sample.

<Player player={subdivMain} code={subdiv} />

## Polyrhythms

You can combine subdivisions and simultaneous samples to create polyrhythms. Let's listen to 3 on 4.

<Player player={polyMain} code={poly} />

## Branching cycles

Hearing the same loop over and over again is boring. Spice it up with _branching_. Each time the cycle loops, a different branch will be chosen.

> Branches multiply, so something that branches two times, then three times, and then four times will be 2 × 3 × 4 = 24 cycles long!

<Player player={branchMain} code={branch} />

## Voices

Up until now, we've only used one voice called `earth`. Let's add a new voice called `wind`. The three possible voices are `earth`, `wind`, and `fire`. Different voices are helpful when you're doing a [`wagsi`](https://github.com/mikesol/wagsi) jam session, as different DJs can work on different areas of a single document. They're also useful if you want to add effects (we'll add effects later).

<Player player={voicesMain} code={voices} />

## Drones

To add a drone, you can use the `air` or `heart` voice followed by the `drone` function with the sample you wish to use. The sample will loop.

<Player player={dronesMain} code={drones} />

## Working with new samples

You can add new samples by providing an object to the `sounds` field of the top-level record. `sounds` takes an object of `BufferUrl`-s, and we can construct it using standard PureScript functions like [`/\`](https://pursuit.purescript.org/packages/purescript-tuples/6.0.1/docs/Data.Tuple.Nested), [`<<<`](https://pursuit.purescript.org/packages/purescript-prelude/5.0.1/docs/Control.Semigroupoid) and [`fromFoldable`](https://pursuit.purescript.org/packages/purescript-foreign-object/3.0.0/docs/Foreign.Object#v:fromFoldable).

<Player player={soundsMain} code={sounds} />

## Changing the volume of a note

You can give any note a tag using a semi-colon (`;`). Then, use the `onTag` function to grab the note and `changeVolume` to change the volume. A couple additional things to note:

1. `const` is a PureScript function that returns constant values.
2. `parse_` must be used to end a chain of one or more `onTag`.

<Player player={volumeMain} code={volume} />

## Changing the rate (pitch) of a note

You can use `changeRate` to change the rate of a note.

<Player preload player={rateMain} code={rate} />

## Working with functions of time

It's often useful to work with functions of time. You can modify both rate and volume as a function of time. There are many different representations of time, so choose wisely! The example below uses:

- `clockTime` to change the volume
- `sampleTime` to change the rate

It also uses a [Low Frequency Oscillator (`lfo`)](https://en.wikipedia.org/wiki/Low-frequency_oscillation). Lastly, it uses the `>>>` operator to pipe values from left-to-right. Because we're making heavy use of the `WAGS.Lib.Tidal.Tidal` module, we'll use a qualified import and rename it `T`.

<Player player={foftMain} code={foft} />

Other types of time you can use include:

- `littleCycleTime`: the time since the branch of a cycle started. For example, if you have a cycle that lasts 4 seconds with 5 branches and you just started branch 3, the value will be `0.0`.
- `bigCycleTime`: the time since the last cycle started. For example, if you have a cycle that lasts 4 seconds with 5 branches and you just started branch 3, the value will be `12.0`.

## Adding effects

You can add aribtrary effects chains to voices. Effect chains must end with an output called `goodbye` and optionally use an input called `hello`. Discarding the input is useful if you want to create purely synthetic effects.

### High-pass filter

Let's add a high-pass filter to create a sweeping effect. The function `ff` here creates a small control-rate delay that smooths over the rapid changes in the filter's frequency, which could cause clicks or pops on some devices.

<Player player={highpassMain} code={highpass} />

### Pan

Let's now try a pan.

<Player player={panMain} code={pan} />

### Synthetic sounds

Let's add a few sine-wave oscillators.

<Player player={sinesMain} code={sines} />

### Delays and feedback

To create a feedback loop, use the `delay` effect as well as `ref`, which is a reference to another node in the graph. In this case, `ref` refers to `myGain`, which is the gain node that we created elsewhere in the graph.

<Player player={feedbackMain} code={feedback} />

### Other effects

Almost all of the effects from the WebAudio API are reproducible using this method. For example, to use an allpass filter instead of a highpass, import `allpass` instead of `highpass`. All importable functions can be found in [this module](https://github.com/mikesol/purescript-wags/blob/main/src/WAGS/Create/Optionals.purs).

## Inspiration

`wags` is heavily indebted to the [Tidal Cycles](https://tidalcycles.org/) project, which inspired its mini-notation. It also makes heavy use of:

- the [PureScript Programming Language](https://purescript.org), a purely functional language originally created by [Phil Freeman](https://twitter.com/paf31).
- cofree comonads, an idea popularized (if not invented) by [Edward Kmett](https://twitter.com/kmett).
- [functional reactive programming](https://en.wikipedia.org/wiki/Functional_reactive_programming), a technique popularized by Conal Elliott and Paul Hudak.

## What next?

You could:
- listen to a track on [wags.fm](https://wags.fm). All of the tracks are editable in real-time just like these examples. You could also propose your own track on the [GitHub](https://github.com/mikesol/wags.fm) or leave a suggestion on the [issues page](https://github.com/mikesol/wags.fm/issues).
- use [wagsi](https://github.com/mikesol/wagsi) to [DJ your own session](https://twitter.com/stronglynormal/status/1459623955719991299) and collaborate with others as you do. Our community has one jam session a month, and we usually meet up on the `#music` channel of the [PureScript Discord](https://purescript.org/chat) server.
- dive into the examples on [`purescript-wags-lib`](https://github.com/mikesol/purescript-wags-lib) for more advanced use cases, including using [TensorFlow.js to create markov models](https://purescript-wags-lib-sector.netlify.app/) (code [here](https://github.com/mikesol/purescript-wags-lib/tree/main/examples/sector)) and [controlling the music with a mouse](https://purescript-wags-lib-sequencer.netlify.app/) (code [here](https://github.com/mikesol/purescript-wags-lib/tree/main/examples/gamelan)).
- embed [wags](https://github.com/mikesol/purescript-wags) into your site to create rich interactive audio experiences, including custom [Audio Worklets](https://developer.mozilla.org/en-US/docs/Web/API/AudioWorklet) and [Analyzers](https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode).

I wish you lots of satisfaction as you play with [Wags](https://github.com/mikesol/purescript-wags) to create music, noise, or whatever makes your ears perk up. Happy wagging!