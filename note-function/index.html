<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/sf/styles.7d91eb3adf281220049b.css" data-identity="gatsby-global-css">html{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif;font-size:62.5%}body{background-color:#f9f9f9;color:#4a4a4a;font-size:1.8rem;line-height:1.618;margin:auto;max-width:38em;padding:13px}@media (max-width:684px){body{font-size:1.53rem}}@media (max-width:382px){body{font-size:1.35rem}}h1,h2,h3,h4,h5,h6{word-wrap:break-word;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif;font-weight:700;line-height:1.1;margin-bottom:1.5rem;margin-top:3rem;overflow-wrap:break-word;-ms-word-break:break-all;word-break:break-word}h1{font-size:2.35em}h2{font-size:2em}h3{font-size:1.75em}h4{font-size:1.5em}h5{font-size:1.25em}h6{font-size:1em}p{margin-bottom:2.5rem;margin-top:0}small,sub,sup{font-size:75%}hr{border-color:#1d7484}a{color:#1d7484;text-decoration:none}a:hover{border-bottom:2px solid #4a4a4a;color:#982c61}a:visited{color:#144f5a}ul{margin-bottom:2.5rem;margin-top:0;padding-left:1.4em}li{margin-bottom:.4em}blockquote{background-color:#f1f1f1;border-left:5px solid #1d7484;margin-bottom:2.5rem;margin-left:0;margin-right:0;padding:.8em .8em .8em 1em}blockquote p{margin-bottom:0}img{height:auto;max-width:100%}img,pre{margin-bottom:2.5rem;margin-top:0}pre{display:block;overflow-x:auto;padding:1em}code,pre{background-color:#f1f1f1}code{font-size:.9em;padding:0 .5em;white-space:pre-wrap}pre>code{background-color:transparent;padding:0;white-space:pre}table{border-collapse:collapse;text-align:justify;width:100%}td,th{border-bottom:1px solid #f1f1f1;padding:.5em}input,textarea{border:1px solid #4a4a4a}input:focus,textarea:focus{border:1px solid #1d7484}textarea{width:100%}.button,button,input[type=button],input[type=reset],input[type=submit]{background-color:#1d7484;border:1px solid #1d7484;border-radius:1px;box-sizing:border-box;color:#f9f9f9;cursor:pointer;display:inline-block;padding:5px 10px;text-align:center;text-decoration:none;white-space:nowrap}.button[disabled],button[disabled],input[type=button][disabled],input[type=reset][disabled],input[type=submit][disabled]{cursor:default;opacity:.5}.button:focus:enabled,.button:hover:enabled,button:focus:enabled,button:hover:enabled,input[type=button]:focus:enabled,input[type=button]:hover:enabled,input[type=reset]:focus:enabled,input[type=reset]:hover:enabled,input[type=submit]:focus:enabled,input[type=submit]:hover:enabled{background-color:#982c61;border-color:#982c61;color:#f9f9f9;outline:0}input,select,textarea{background-color:#f1f1f1;border:1px solid #f1f1f1;border-radius:4px;box-shadow:none;box-sizing:border-box;color:#4a4a4a;margin-bottom:10px;padding:6px 10px}input:focus,select:focus,textarea:focus{border:1px solid #1d7484;outline:0}input[type=checkbox]:focus{outline:1px dotted #1d7484}fieldset,label,legend{display:block;font-weight:600;margin-bottom:.5rem}</style><meta name="generator" content="Gatsby 4.0.0"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><link rel="preconnect" href="https://www.google-analytics.com"/><link rel="dns-prefetch" href="https://www.google-analytics.com"/><style type="text/css">svg:not(:root).svg-inline--fa {
  overflow: visible;
}

.svg-inline--fa {
  display: inline-block;
  font-size: inherit;
  height: 1em;
  overflow: visible;
  vertical-align: -0.125em;
}
.svg-inline--fa.fa-lg {
  vertical-align: -0.225em;
}
.svg-inline--fa.fa-w-1 {
  width: 0.0625em;
}
.svg-inline--fa.fa-w-2 {
  width: 0.125em;
}
.svg-inline--fa.fa-w-3 {
  width: 0.1875em;
}
.svg-inline--fa.fa-w-4 {
  width: 0.25em;
}
.svg-inline--fa.fa-w-5 {
  width: 0.3125em;
}
.svg-inline--fa.fa-w-6 {
  width: 0.375em;
}
.svg-inline--fa.fa-w-7 {
  width: 0.4375em;
}
.svg-inline--fa.fa-w-8 {
  width: 0.5em;
}
.svg-inline--fa.fa-w-9 {
  width: 0.5625em;
}
.svg-inline--fa.fa-w-10 {
  width: 0.625em;
}
.svg-inline--fa.fa-w-11 {
  width: 0.6875em;
}
.svg-inline--fa.fa-w-12 {
  width: 0.75em;
}
.svg-inline--fa.fa-w-13 {
  width: 0.8125em;
}
.svg-inline--fa.fa-w-14 {
  width: 0.875em;
}
.svg-inline--fa.fa-w-15 {
  width: 0.9375em;
}
.svg-inline--fa.fa-w-16 {
  width: 1em;
}
.svg-inline--fa.fa-w-17 {
  width: 1.0625em;
}
.svg-inline--fa.fa-w-18 {
  width: 1.125em;
}
.svg-inline--fa.fa-w-19 {
  width: 1.1875em;
}
.svg-inline--fa.fa-w-20 {
  width: 1.25em;
}
.svg-inline--fa.fa-pull-left {
  margin-right: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-pull-right {
  margin-left: 0.3em;
  width: auto;
}
.svg-inline--fa.fa-border {
  height: 1.5em;
}
.svg-inline--fa.fa-li {
  width: 2em;
}
.svg-inline--fa.fa-fw {
  width: 1.25em;
}

.fa-layers svg.svg-inline--fa {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.fa-layers {
  display: inline-block;
  height: 1em;
  position: relative;
  text-align: center;
  vertical-align: -0.125em;
  width: 1em;
}
.fa-layers svg.svg-inline--fa {
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter, .fa-layers-text {
  display: inline-block;
  position: absolute;
  text-align: center;
}

.fa-layers-text {
  left: 50%;
  top: 50%;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -webkit-transform-origin: center center;
          transform-origin: center center;
}

.fa-layers-counter {
  background-color: #ff253a;
  border-radius: 1em;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  color: #fff;
  height: 1.5em;
  line-height: 1;
  max-width: 5em;
  min-width: 1.5em;
  overflow: hidden;
  padding: 0.25em;
  right: 0;
  text-overflow: ellipsis;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-bottom-right {
  bottom: 0;
  right: 0;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom right;
          transform-origin: bottom right;
}

.fa-layers-bottom-left {
  bottom: 0;
  left: 0;
  right: auto;
  top: auto;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: bottom left;
          transform-origin: bottom left;
}

.fa-layers-top-right {
  right: 0;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top right;
          transform-origin: top right;
}

.fa-layers-top-left {
  left: 0;
  right: auto;
  top: 0;
  -webkit-transform: scale(0.25);
          transform: scale(0.25);
  -webkit-transform-origin: top left;
          transform-origin: top left;
}

.fa-lg {
  font-size: 1.3333333333em;
  line-height: 0.75em;
  vertical-align: -0.0667em;
}

.fa-xs {
  font-size: 0.75em;
}

.fa-sm {
  font-size: 0.875em;
}

.fa-1x {
  font-size: 1em;
}

.fa-2x {
  font-size: 2em;
}

.fa-3x {
  font-size: 3em;
}

.fa-4x {
  font-size: 4em;
}

.fa-5x {
  font-size: 5em;
}

.fa-6x {
  font-size: 6em;
}

.fa-7x {
  font-size: 7em;
}

.fa-8x {
  font-size: 8em;
}

.fa-9x {
  font-size: 9em;
}

.fa-10x {
  font-size: 10em;
}

.fa-fw {
  text-align: center;
  width: 1.25em;
}

.fa-ul {
  list-style-type: none;
  margin-left: 2.5em;
  padding-left: 0;
}
.fa-ul > li {
  position: relative;
}

.fa-li {
  left: -2em;
  position: absolute;
  text-align: center;
  width: 2em;
  line-height: inherit;
}

.fa-border {
  border: solid 0.08em #eee;
  border-radius: 0.1em;
  padding: 0.2em 0.25em 0.15em;
}

.fa-pull-left {
  float: left;
}

.fa-pull-right {
  float: right;
}

.fa.fa-pull-left,
.fas.fa-pull-left,
.far.fa-pull-left,
.fal.fa-pull-left,
.fab.fa-pull-left {
  margin-right: 0.3em;
}
.fa.fa-pull-right,
.fas.fa-pull-right,
.far.fa-pull-right,
.fal.fa-pull-right,
.fab.fa-pull-right {
  margin-left: 0.3em;
}

.fa-spin {
  -webkit-animation: fa-spin 2s infinite linear;
          animation: fa-spin 2s infinite linear;
}

.fa-pulse {
  -webkit-animation: fa-spin 1s infinite steps(8);
          animation: fa-spin 1s infinite steps(8);
}

@-webkit-keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}

@keyframes fa-spin {
  0% {
    -webkit-transform: rotate(0deg);
            transform: rotate(0deg);
  }
  100% {
    -webkit-transform: rotate(360deg);
            transform: rotate(360deg);
  }
}
.fa-rotate-90 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";
  -webkit-transform: rotate(90deg);
          transform: rotate(90deg);
}

.fa-rotate-180 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2)";
  -webkit-transform: rotate(180deg);
          transform: rotate(180deg);
}

.fa-rotate-270 {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=3)";
  -webkit-transform: rotate(270deg);
          transform: rotate(270deg);
}

.fa-flip-horizontal {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=0, mirror=1)";
  -webkit-transform: scale(-1, 1);
          transform: scale(-1, 1);
}

.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(1, -1);
          transform: scale(1, -1);
}

.fa-flip-both, .fa-flip-horizontal.fa-flip-vertical {
  -ms-filter: "progid:DXImageTransform.Microsoft.BasicImage(rotation=2, mirror=1)";
  -webkit-transform: scale(-1, -1);
          transform: scale(-1, -1);
}

:root .fa-rotate-90,
:root .fa-rotate-180,
:root .fa-rotate-270,
:root .fa-flip-horizontal,
:root .fa-flip-vertical,
:root .fa-flip-both {
  -webkit-filter: none;
          filter: none;
}

.fa-stack {
  display: inline-block;
  height: 2em;
  position: relative;
  width: 2.5em;
}

.fa-stack-1x,
.fa-stack-2x {
  bottom: 0;
  left: 0;
  margin: auto;
  position: absolute;
  right: 0;
  top: 0;
}

.svg-inline--fa.fa-stack-1x {
  height: 1em;
  width: 1.25em;
}
.svg-inline--fa.fa-stack-2x {
  height: 2em;
  width: 2.5em;
}

.fa-inverse {
  color: #fff;
}

.sr-only {
  border: 0;
  clip: rect(0, 0, 0, 0);
  height: 1px;
  margin: -1px;
  overflow: hidden;
  padding: 0;
  position: absolute;
  width: 1px;
}

.sr-only-focusable:active, .sr-only-focusable:focus {
  clip: auto;
  height: auto;
  margin: 0;
  overflow: visible;
  position: static;
  width: auto;
}

.svg-inline--fa .fa-primary {
  fill: var(--fa-primary-color, currentColor);
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa .fa-secondary {
  fill: var(--fa-secondary-color, currentColor);
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-primary {
  opacity: 0.4;
  opacity: var(--fa-secondary-opacity, 0.4);
}

.svg-inline--fa.fa-swap-opacity .fa-secondary {
  opacity: 1;
  opacity: var(--fa-primary-opacity, 1);
}

.svg-inline--fa mask .fa-primary,
.svg-inline--fa mask .fa-secondary {
  fill: black;
}

.fad.fa-inverse {
  color: #fff;
}</style><title data-react-helmet="true">Soundly functional</title><link data-react-helmet="true" rel="canonical" href="http://mikesol.github.io/fp-sound"/><meta data-react-helmet="true" charSet="utf-8"/><link rel="sitemap" type="application/xml" href="/sf/sitemap/sitemap-index.xml"/><link rel="icon" href="/sf/favicon-32x32.png?v=ee9345bdf569bb5c1b4b55427242827c" type="image/png"/><link rel="manifest" href="/sf/manifest.webmanifest" crossorigin="anonymous"/><link rel="apple-touch-icon" sizes="48x48" href="/sf/icons/icon-48x48.png?v=ee9345bdf569bb5c1b4b55427242827c"/><link rel="apple-touch-icon" sizes="72x72" href="/sf/icons/icon-72x72.png?v=ee9345bdf569bb5c1b4b55427242827c"/><link rel="apple-touch-icon" sizes="96x96" href="/sf/icons/icon-96x96.png?v=ee9345bdf569bb5c1b4b55427242827c"/><link rel="apple-touch-icon" sizes="144x144" href="/sf/icons/icon-144x144.png?v=ee9345bdf569bb5c1b4b55427242827c"/><link rel="apple-touch-icon" sizes="192x192" href="/sf/icons/icon-192x192.png?v=ee9345bdf569bb5c1b4b55427242827c"/><link rel="apple-touch-icon" sizes="256x256" href="/sf/icons/icon-256x256.png?v=ee9345bdf569bb5c1b4b55427242827c"/><link rel="apple-touch-icon" sizes="384x384" href="/sf/icons/icon-384x384.png?v=ee9345bdf569bb5c1b4b55427242827c"/><link rel="apple-touch-icon" sizes="512x512" href="/sf/icons/icon-512x512.png?v=ee9345bdf569bb5c1b4b55427242827c"/><link as="script" rel="preload" href="/sf/webpack-runtime-89ebbb5491501f9f8d1c.js"/><link as="script" rel="preload" href="/sf/framework-b9deb5b1814bf6b76933.js"/><link as="script" rel="preload" href="/sf/de3309da-22f6f90c02655d800791.js"/><link as="script" rel="preload" href="/sf/469bb142-338af84dab33a00cd09c.js"/><link as="script" rel="preload" href="/sf/5f97a78d-28fbe6c0f50b244b2a9c.js"/><link as="script" rel="preload" href="/sf/4317adae-b2dd59357a3b470e9581.js"/><link as="script" rel="preload" href="/sf/532a2f07-688adb9b4acf536f0e77.js"/><link as="script" rel="preload" href="/sf/cb1608f2-b226e0f60ee15e1f6380.js"/><link as="script" rel="preload" href="/sf/app-430ebca110f3a361ea83.js"/><link as="script" rel="preload" href="/sf/component---src-pages-note-function-mdx-7c0b9704265813025315.js"/><link as="fetch" rel="preload" href="/sf/page-data/note-function/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/sf/page-data/app-data.json" crossorigin="anonymous"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><div class="application"><h1>The note and the function</h1><p>We&#x27;ll start our journey with a single note produced by a sine-wave oscillator. When you click <svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg>, the computer will send instructions to your loudspeaker or headphones to oscillate back and forth in sinusoidal motion. This creates wave-like variations in the air that propagate all the way to your ear. Middle-C, the note below, will cause the air around your ear to vibrate 264 times a second. Our ear clumps these oscillations together as a pattern, and we hear it as a pitch. To learn more about the physics of sound, I highly recommend checking out this <a href="https://pudding.cool/2018/02/waveforms/">amazing interactive article in The Pudding</a>.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch

main :: Player
main = player c4</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch

main :: Player
main = player c4</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>The player above, as well as all of the players in this article, are editable. For example, try changing the note above from <code>c4</code> to <code>d4</code>, <code>aFlat5</code>, or <code>fSharp1</code> and see what happens.</p><p>Our single note is accompanied by a short program: the minimal amount of information we need to play back the note. The program starts by defining a <strong>module</strong>. As a convention, we usually call the main module <code>Main</code>. This is followed by a series of <code>import</code> statements declaring what types and terms we&#x27;ll use from other libraries (I&#x27;ll define &quot;type&quot; and &quot;term&quot; below). Lastly, the actual program called <code>main</code> exists on two levels: the type-level (its type is <code>Player</code>) and on the term-level (its terms are <code>player</code> and <code>c4</code>). This distinction between, and eventual interplay of, types and terms will be crucial to our reasoning about music and programs.</p><h2>Types and terms</h2><p>Programs in PureScript contain two basic units of composition: <em>types</em> and <em>terms</em>. These units form the basis of a play starring three core protagonists: you, a compiler, and a computer. A <em>term</em> points to some chunk of memory on a computer that stores an opaque series of bytes. We give the term a name like <code>c4</code> or <code>player</code> to indicate to other readers what it <em>is</em> or <em>does</em>. A <em>type</em> is an assertion to the compiler about how a term can be used in a program. Types have names like <code>Player</code>. When the compiler receives an assertion in the form of a type, it can either accept the assertion, reject it, or punt until it receives more information. In our program above, the compiler <em>accepts</em> the assertion that <code>player c4</code> has the type <code>Player</code>. When all the assertions in a program are accepted, we say a program compiles, and the compiler sends the program off to the computer to do something interesting like render it to your screen, play it through your loudspeakers, or save it for a rainy day.</p><p>Let&#x27;s revisit the program above:</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch

main :: Player
main = player c4</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch

main :: Player
main = player c4</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>It contains one type assertion — that <code>main</code> is of type <code>Player</code> — and three terms:</p><ul><li><code>main</code>, whose type is asserted to be <code>Player</code>;</li><li><code>player</code>, whose type is defined in <code>Wags.Lib.Learn</code> as <code>Pitch ((-&gt;) Number) -&gt; Player</code>; and</li><li><code>c4</code>, whose type is defined in <code>Wags.Lib.Learn.Pitch</code> as <code>Pitch ((-&gt;) Number)</code>.</li></ul><p>When the compiler compiles the program, it treats every function as an <em>if/then</em> proposition and makes sure that we&#x27;ve provided enough evidence to prove this proposition. In the case above, <code>player</code> is a proposition saying:</p><blockquote><p>If you give me a <code>Pitch ((-&gt;) Number)</code>, I&#x27;ll give you a term of type <code>Player</code></p></blockquote><p>In the program, <code>c4</code> is <em>evidence</em> to <code>player</code> (we can also call it an argument to <code>player</code> or <code>player</code>&#x27;s input). Evidence to propositions, or equivalently arguments to functions, act like keys to a lock. The term <code>c4</code> of type <code>Pitch ((-&gt;) Number)</code> unlocks the proposition <code>Pitch ((-&gt;) Number) -&gt; Player</code>, producing a <code>Player</code>. Because we have annotated our program <code>main</code> as <code>Player</code>, the compiler accepts the program, sends it to your loudspeaker and plays a note. w00t!</p><p>The fluidity with which one can switch between the language of logic (proving a proposition with evidence) and programming (applying to a function an argument) is called the <a href="https://en.wikipedia.org/wiki/Curry%E2%80%93Howard_correspondence">Curry-Howard correspondence</a>. Informally, it posits that programs are logical proofs and vice versa. Granted, music is a highly <em>illogical</em> endeavor, so this type of rigorous formalism may seem out of place given the deeply subjective nature of music composition and listening. The point of types here is to provide a set of constraints that accomplish two goals:</p><ol><li>Types act as proof that what you&#x27;re building has the best chance to work as expected. This means that you&#x27;ll spend less time fixing bugs and more time making music.</li><li>The best constraints act simultaneously as dialectical guides through <em>and</em> impediments to creation. The epiphanies we have as we are guided and impeded help us make great work.</li></ol><h2>Our first composition(s)</h2><p>In the example above, we listened to our first note <code>c4</code> by applying the function <code>player</code> to it. Let&#x27;s use some more functions to see how far we can push that note.</p><p>We&#x27;ll start by acting on the volume of the note as a function of time.  Let&#x27;s make the note taper down to zero-volume over 5 seconds. To do so, we&#x27;ll write a function that multiplies time by 0.2 and subtracts it from 1.0, which will smoothly interpolate from 1 to 0 over 5 seconds.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)

fadeOut :: Number -&gt; Number
fadeOut time = if time &gt; 5.0 then 0.0 else 1.0 - (0.2 * time)

main :: Player
main = player (note_ (Volume fadeOut) longest c4)</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)

fadeOut :: Number -&gt; Number
fadeOut time = if time &gt; 5.0 then 0.0 else 1.0 - (0.2 * time)

main :: Player
main = player (note_ (Volume fadeOut) longest c4)</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>An equivalent way to write that would be the following:</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Math (calcSlope)
import WAGS.Lib.Tidal.Tidal (betwixt)

fadeOut :: Number -&gt; Number
fadeOut time = betwixt 0.0 1.0 (calcSlope 0.0 1.0 5.0 0.0 time)

main :: Player
main = player (note_ (Volume fadeOut) longest c4)</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Math (calcSlope)
import WAGS.Lib.Tidal.Tidal (betwixt)

fadeOut :: Number -&gt; Number
fadeOut time = betwixt 0.0 1.0 (calcSlope 0.0 1.0 5.0 0.0 time)

main :: Player
main = player (note_ (Volume fadeOut) longest c4)</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p><a href="https://github.com/mikesol/purescript-wags/blob/81dd024e13ad2bdb6a2598b29e86105fa762b7a9/src/WAGS/Math.purs#L7"><code>calcSlope</code></a> and <a href="https://github.com/mikesol/purescript-wags-lib/blob/a1569215c2360461f70f1e6505d01ec3d5a72f05/src/WAGS/Lib/Tidal/Tidal.purs#L953"><code>betwixt</code></a> are functions provided by the libraries <a href="https://github.com/mikesol/purescript-wags"><code>wags</code></a> and <a href="https://github.com/mikesol/purescript-wags-lib"><code>wags-lib</code></a>, as will be the case of many of the functions we&#x27;ll encounter along our path.  While we&#x27;ll use these functions for convenience, it&#x27;s often helpful to write them out by hand for learning purposes.  As a challenge throughout this and other articles, after reading the article once, try to write some these functions from scratch and compare them to the library implementations. If you feel that your implementation is better, please make a <a href="https://docs.github.com/en/pull-requests/collaborating-with-pull-requests/proposing-changes-to-your-work-with-pull-requests/about-pull-requests">pull request</a>!</p><p>When working with functions of time like <code>calcSlope</code>, one common convention is to leave <code>time</code> as the last argument. If we write a function <code>f</code> of <code>time</code> that internally calls a function <code>g</code> of <code>time</code>, we say that <code>time</code> is an <a href="https://en.wikipedia.org/wiki/Lambda_calculus"><em>abstraction</em></a> over the function <code>g</code>. Without the <code>time</code> term, we call the function <code>f</code> <a href="https://wiki.haskell.org/Eta_conversion"><em>eta-reduced</em></a>.</p><deckgo-highlight-code language="haskell">
          <code slot="code">f time = g time -- time abstracted over g
f = g -- eta-reduced</code>
        </deckgo-highlight-code><p>This is similar to reducing a term in algebra:</p><deckgo-highlight-code language="haskell">
          <code slot="code">f + 2 = g + 2 -- ...is the same as stating that...
f = g</code>
        </deckgo-highlight-code><p>The idea of abstraction (<em>defining</em> a function) and application (<em>invoking</em> a function) are core to a formal system in mathematical logic called the <a href="https://en.wikipedia.org/wiki/Lambda_calculus">Lambda Calculus</a>. Developed in the 1930s by Alonzo Church, the Lambda Calculus acts as a syntactic basis for most functional programming languages, including PureScript.</p><p>In order to eta-reduce <code>fadeOut</code> in the example above, we introduce one of the most powerful ideas in functional programming — composition, which we will represent as <code>&lt;&lt;&lt;</code>. When you compose two functions, you pipe the output of one into the input of another without <em>abstracting</em> the input to either function.  If we write <code>h time = f (g time)</code>, <code>time</code> is abstracted over <code>g</code> and <code>(g time)</code> is abstracted over <code>f</code>. However, if we write <code>h = f &lt;&lt;&lt; g</code>, the abstraction is eta-reduced <em>both</em> for <code>g</code>&#x27;s input <em>and</em> for <code>f</code>&#x27;s input. Let&#x27;s see that in the example using <code>betwixt</code> and <code>calcSlope</code>. The <code>time</code> term is no longer present - it has been eta-reduced using function composition.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Math (calcSlope)
import WAGS.Lib.Tidal.Tidal (betwixt)

fadeOut :: Number -&gt; Number
fadeOut = betwixt 0.0 1.0 &lt;&lt;&lt; calcSlope 0.0 1.0 5.0 0.0

main :: Player
main = player (note_ (Volume fadeOut) longest c4)</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Math (calcSlope)
import WAGS.Lib.Tidal.Tidal (betwixt)

fadeOut :: Number -&gt; Number
fadeOut = betwixt 0.0 1.0 &lt;&lt;&lt; calcSlope 0.0 1.0 5.0 0.0

main :: Player
main = player (note_ (Volume fadeOut) longest c4)</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>Function composition is not just about terser syntax. In fact, the terser syntax — also called point-free syntax — often leads to a golf-like competition to make code as short as possible and, when done too eagerly, unreadable. As we will see in subsequent articles on <a href="https://pursuit.purescript.org/packages/purescript-profunctor/5.0.0/docs/Data.Profunctor#t:Profunctor">Profunctors</a> and <a href="https://github.com/natefaubion/purescript-free-semigroupoid">Free Semigroupoids</a>, composition can be applied to other things besides functions. By working at this higher level of abstraction, we unteather ourselves from functions and think in more general terms about output flowing into input. For me, this type of abstract reasoning is one of the joys of both music and functional programming, making it possible to exploit structural similarities at multiple levels of abstraction.</p><h3>A bouquet of functions</h3><p>Let&#x27;s write another function of time that makes our note step between different volumes in a cyclic fashion. We&#x27;ll accomplish this using the <a href="https://pursuit.purescript.org/packages/purescript-math/3.0.0/docs/Math#v:remainder">remainder operator</a> and <a href="https://github.com/purescript/documentation/blob/master/language/Pattern-Matching.md#guards">guards</a>.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import Math ((%))
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)

guarded :: Number -&gt; Number
guarded t =
  let
    time = t % 2.0
    out
      | time &lt; 0.125 = 0.1
      | time &lt; 0.25 = 0.0
      | time &lt; 0.5 = 0.8
      | time &lt; 0.625 = 0.0
      | time &lt; 0.875 = 0.8
      | time &lt; 1.0 = 0.1
      | time &lt; 1.25 = 0.0
      | time &lt; 1.5 = 0.5
      | time &lt; 1.75 = 0.0
      | otherwise = 0.5
  in
    out

main :: Player
main = player (note_ (Volume guarded) longest c4)</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import Math ((%))
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)

guarded :: Number -&gt; Number
guarded t =
  let
    time = t % 2.0
    out
      | time &lt; 0.125 = 0.1
      | time &lt; 0.25 = 0.0
      | time &lt; 0.5 = 0.8
      | time &lt; 0.625 = 0.0
      | time &lt; 0.875 = 0.8
      | time &lt; 1.0 = 0.1
      | time &lt; 1.25 = 0.0
      | time &lt; 1.5 = 0.5
      | time &lt; 1.75 = 0.0
      | otherwise = 0.5
  in
    out

main :: Player
main = player (note_ (Volume guarded) longest c4)</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>We can also control the volume with a <a href="https://en.wikipedia.org/wiki/Low-frequency_oscillation">low-frequency oscilator, or LFO</a>.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Note (note_)

bending :: Number -&gt; Number
bending = add 0.3 &lt;&lt;&lt; lfo { phase: 0.0, amp: 0.3, freq: 8.0 }

main :: Player
main = player (note_ (Volume bending) longest c4)</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Note (note_)

bending :: Number -&gt; Number
bending = add 0.3 &lt;&lt;&lt; lfo { phase: 0.0, amp: 0.3, freq: 8.0 }

main :: Player
main = player (note_ (Volume bending) longest c4)</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>The one thing that all of these examples have in common is that they are functions from a <code>Number</code> to a <code>Number</code>. As the output of one can be the input of another, we can <em>compose</em> them together. Interestingly, the meanings of the word &quot;composition&quot; in music and functional programming largely overlap. When we compose music, we blend together sounds either in a sequence or simultaneously to crete a larger work. When we compose programs, we blend together functions to create complex control patterns and data flow.</p><p>Let&#x27;s compose three functions together using the purescript operator <code>&lt;&lt;&lt;</code>. The first one will be our LFO, the second will add an offset, and the third will clip the wave at boundaires.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Note (note_)

lfoIt :: Number -&gt; Number
lfoIt = lfo { phase: 0.0, amp: 0.3, freq: 8.0 }

offsetIt :: Number -&gt; Number
offsetIt = add 0.5

clipIt :: Number -&gt; Number
clipIt = max 0.4 &lt;&lt;&lt; min 0.6

main :: Player
main = player
  $ note_
      ( Volume $
          clipIt
            &lt;&lt;&lt; offsetIt
            &lt;&lt;&lt; lfoIt
      )
      longest
      c4
</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Note (note_)

lfoIt :: Number -&gt; Number
lfoIt = lfo { phase: 0.0, amp: 0.3, freq: 8.0 }

offsetIt :: Number -&gt; Number
offsetIt = add 0.5

clipIt :: Number -&gt; Number
clipIt = max 0.4 &lt;&lt;&lt; min 0.6

main :: Player
main = player
  $ note_
      ( Volume $
          clipIt
            &lt;&lt;&lt; offsetIt
            &lt;&lt;&lt; lfoIt
      )
      longest
      c4
</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>Visually, the result looks something like this:</p><div style="width:100%;height:300px"><div class="ReactChart " style="width:0;height:0;position:relative"><svg style="width:0;height:0;overflow:hidden"><g style="transform:translate3d(0px, 0px, 0)"><rect x="0" y="0" width="0" height="0" style="stroke-width:0;fill:#333;opacity:0;rx:0;ry:0"></rect><g class="axes"><g class="Axis" style="pointer-events:none;transform:translate3d(0, 0px, 0)"><path class="domain" d="
        M 0, 6
        V 0
        H 0
        V 6
      " style="stroke-width:1;stroke:rgba(0,0,0, .1);fill:transparent;opacity:1"></path><g class="ticks"><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.0</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.1</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.2</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.3</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.4</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.5</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.6</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.7</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.8</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">0.9</text></g></g><g class="tick" style="transform:translate3d(0px, 0, 0)"><line class="gridLine" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="0" y1="0" y2="6" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="hanging" text-anchor="middle" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(0px, 20px, 0) rotate(0deg)">1.0</text></g></g></g></g><g class="Axis" style="pointer-events:none"><path class="domain" d="
        M -6, 0
        H 0
        V 0
        H -6
      " style="stroke-width:1;stroke:rgba(0,0,0, .1);fill:transparent;opacity:1"></path><g class="ticks"><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.40</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.42</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.44</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.46</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.48</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.50</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.52</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.54</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.56</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.58</text></g></g><g class="tick" style="transform:translate3d(0, 0px, 0)"><line class="gridLine" x1="0" x2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><g class="labelGroup"><line class="tickline" x1="0" x2="-6" y1="0" y2="0" style="stroke-width:1;fill:transparent;opacity:1;stroke:rgba(0,0,0, .1)"></line><text class="tickLabel" dominant-baseline="central" text-anchor="end" style="font-family:sans-serif;font-size:10px;opacity:1;fill:black;transform:translate3d(-20px, 0px, 0) rotate(0deg)">0.60</text></g></g></g></g></g><g class="Series" style="pointer-events:none"><g><path d="M0,0Z" style="stroke-width:2;stroke:#4ab5eb;fill:none;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></path><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle><circle cx="0" cy="0" r="1" style="r:2px;stroke-width:1;stroke:#4ab5eb;fill:#4ab5eb;opacity:1;area:[object Object];line:[object Object];rectangle:[object Object];circle:[object Object]"></circle></g></g></g></svg></div></div><p>There&#x27;s a special term for functions whose input type is the same as the output type. We call these <em>endo</em> functions — endo being a prefix from the Greek ἔνδον (endon) meaning &quot;within, inner, absorbing, or containing.&quot; We can chain together compositions of endo-functions to create some pretty jolting sounds.</p><p>The beautiful thing about chaining compositions of endo-functions is that you can comment out different functions using two dashes <code>--</code> to change the result. In the example below, in addition to playing around with the values, try to comment out some functions (add <code>--</code>) and comment in (remove <code>--</code>) others.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import Math (pi, pow)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Note (note_)

lfo1It :: Number -&gt; Number
lfo1It = lfo { phase: 0.0, amp: 0.3, freq: 4.0 }

lfo2It :: Number -&gt; Number
lfo2It = lfo { phase: pi, amp: 2.0, freq: 8.0 }

lfo3It :: Number -&gt; Number
lfo3It = lfo { phase: pi, amp: 2.0, freq: 16.0 }

squareRootIt :: Number -&gt; Number
squareRootIt = flip pow 0.5

squareIt :: Number -&gt; Number
squareIt = flip pow 0.5

clipIt :: Number -&gt; Number
clipIt = max 0.0 &lt;&lt;&lt; min 1.0

main :: Player
main = player
  $ note_
      ( Volume $
          clipIt
            &lt;&lt;&lt; lfo3It
            &lt;&lt;&lt; squareRootIt
            -- &lt;&lt;&lt; lfo2It
            &lt;&lt;&lt; squareIt
            &lt;&lt;&lt; lfo1It
      )
      longest
      c4
</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import Math (pi, pow)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Note (note_)

lfo1It :: Number -&gt; Number
lfo1It = lfo { phase: 0.0, amp: 0.3, freq: 4.0 }

lfo2It :: Number -&gt; Number
lfo2It = lfo { phase: pi, amp: 2.0, freq: 8.0 }

lfo3It :: Number -&gt; Number
lfo3It = lfo { phase: pi, amp: 2.0, freq: 16.0 }

squareRootIt :: Number -&gt; Number
squareRootIt = flip pow 0.5

squareIt :: Number -&gt; Number
squareIt = flip pow 0.5

clipIt :: Number -&gt; Number
clipIt = max 0.0 &lt;&lt;&lt; min 1.0

main :: Player
main = player
  $ note_
      ( Volume $
          clipIt
            &lt;&lt;&lt; lfo3It
            &lt;&lt;&lt; squareRootIt
            -- &lt;&lt;&lt; lfo2It
            &lt;&lt;&lt; squareIt
            &lt;&lt;&lt; lfo1It
      )
      longest
      c4
</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><h2>A taste of things to come</h2><p>In this article series, I will try to keep the pacing of the material more or less consistent. However, at certain points, I will glimpse into the future to show you where we are heading by subtly tweaking an example. I intend to write full articles devoted to functors, applicatives, folds, semigroups and monoids, so consider this a small <em>mise en bouche</em> for the not-too-distant future.</p><h3>Functors and applicatives</h3><p>Currently, while we have a way to pipe output into an input via composition, we have no way to <em>blend</em> two results together. For example, if we want to add the result of an LFO to the result of a terraced function, we would write something like <code>(\time -&gt; lfo time + terraced time)</code>. While this is fine in small doses, it gets tedious if <em>everything</em> is a function of time. Instead, we&#x27;d like for time to flow from function to function automatically. In functional programming, there are many ways to do this, including the <a href="https://pursuit.purescript.org/packages/purescript-transformers/5.1.0/docs/Control.Monad.Reader#t:Reader"><code>Reader</code></a> pattern and the <a href="https://pursuit.purescript.org/packages/purescript-behaviors/7.0.0/docs/FRP.Behavior#t:Behavior"><code>Behavior</code></a> pattern. We&#x27;ll see both of those in a later article, but what I&#x27;d like to show here is how to accomplish this using functors and applicatives.</p><p>The example below, we&#x27;ll write the same function with <code>time</code> abstracted over the function and without <code>time</code> abstracted. The &quot;without&quot; version uses functors via the <a href="https://pursuit.purescript.org/packages/purescript-prelude/5.0.1/docs/Data.Functor#t:Functor"><code>&lt;$&gt;</code> or <em>map</em></a> operator and applicative functors via the <a href="https://pursuit.purescript.org/packages/purescript-prelude/5.0.1/docs/Control.Apply#t:Apply"><code>&lt;*&gt;</code> or <em>apply</em></a> operator. You can think of them as &quot;lifting&quot; a computation (in this case, a function of time) into an abstraction. When we &quot;lower&quot; the computation, we get the abstraction over time back. If you substitute <code>variation1</code> for <code>variation2</code>, you&#x27;ll hear no difference.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import Math ((%))
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)

bending :: Number -&gt; Number
bending = lfo { phase: 0.0, amp: 0.25, freq: 8.0 }

guarded :: Number -&gt; Number
guarded t =
  let
    time = t % 1.0
    out
      | time &lt; 0.125 = 0.3
      | time &lt; 0.25 = 0.0
      | time &lt; 0.5 = 0.6
      | time &lt; 0.625 = 0.0
      | time &lt; 0.875 = 0.3
      | otherwise = 0.0
  in
    out

version1 :: Number -&gt; Number
version1 time = add (bending time) (guarded time)

version2 :: Number -&gt; Number
version2 = add &lt;$&gt; bending &lt;*&gt; guarded

main :: Player
main = player (note_ (Volume version2) longest c4)</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import Math ((%))
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)

bending :: Number -&gt; Number
bending = lfo { phase: 0.0, amp: 0.25, freq: 8.0 }

guarded :: Number -&gt; Number
guarded t =
  let
    time = t % 1.0
    out
      | time &lt; 0.125 = 0.3
      | time &lt; 0.25 = 0.0
      | time &lt; 0.5 = 0.6
      | time &lt; 0.625 = 0.0
      | time &lt; 0.875 = 0.3
      | otherwise = 0.0
  in
    out

version1 :: Number -&gt; Number
version1 time = add (bending time) (guarded time)

version2 :: Number -&gt; Number
version2 = add &lt;$&gt; bending &lt;*&gt; guarded

main :: Player
main = player (note_ (Volume version2) longest c4)</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>Using this technique, you can blend together functions of time using binary operations, functors, applicatives, and function composition. The example below is a small Bolero using all three techniques. Play around with the parameters to see how it changes!</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import Math (pi)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)

type FofTime = Number -&gt; Number

driver1 :: FofTime
driver1 = lfo { phase: 0.0, amp: 2.0, freq: 1.0 }

freq1 :: FofTime
freq1 = lfo { phase: 0.0, amp: 1.0, freq: 2.0 }

driver2 :: FofTime
driver2 = lfo { phase: 0.0, amp: 1.5, freq: 0.25 }

freq2 :: FofTime
freq2 = lfo { phase: pi, amp: 1.0, freq: 1.0 }

signal :: FofTime
signal = min 1.0 &lt;&lt;&lt; mul 0.6 &lt;&lt;&lt; max 0.0 &lt;&lt;&lt;
  (add &lt;$&gt; (freq1 &lt;&lt;&lt; driver1) &lt;*&gt; (freq2 &lt;&lt;&lt; driver2))

main :: Player
main = player (note_ (Volume signal) longest c4)</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import Math (pi)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)

type FofTime = Number -&gt; Number

driver1 :: FofTime
driver1 = lfo { phase: 0.0, amp: 2.0, freq: 1.0 }

freq1 :: FofTime
freq1 = lfo { phase: 0.0, amp: 1.0, freq: 2.0 }

driver2 :: FofTime
driver2 = lfo { phase: 0.0, amp: 1.5, freq: 0.25 }

freq2 :: FofTime
freq2 = lfo { phase: pi, amp: 1.0, freq: 1.0 }

signal :: FofTime
signal = min 1.0 &lt;&lt;&lt; mul 0.6 &lt;&lt;&lt; max 0.0 &lt;&lt;&lt;
  (add &lt;$&gt; (freq1 &lt;&lt;&lt; driver1) &lt;*&gt; (freq2 &lt;&lt;&lt; driver2))

main :: Player
main = player (note_ (Volume signal) longest c4)</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><h3>Folds</h3><p>In functional programming, rather than applying a function to arguments, we often store arguments in a structure called a <em>free</em> structure and then <em>interpret</em> that structure later. Let&#x27;s do that with function composition. Rather than applying it directly, we&#x27;ll store its arguments in a free structure (an Array, also known as a &quot;free monoid&quot;) and then interpret it using a simple interpreter called <code>foldl</code> that applies a function (in this case, <a href="https://pursuit.purescript.org/packages/purescript-prelude/5.0.1/docs/Control.Semigroupoid#t:Semigroupoid"><code>&lt;&lt;&lt;</code></a>) to the arguments starting from an initial argument. Here, the initial argument is <a href="https://pursuit.purescript.org/packages/purescript-prelude/5.0.1/docs/Control.Category#t:Category"><code>identity</code></a> — a function that returns its argument. In the example below, the result is low-fi dither that&#x27;ll make your car bounce if you crank it to 11!</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Foldable (foldl)
import Math (pi, pow)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

lfo1It :: Number -&gt; Number
lfo1It = lfo { phase: 0.0, amp: 0.3, freq: 4.0 }

lfo2It :: Number -&gt; Number
lfo2It = lfo { phase: pi, amp: 2.0, freq: 8.0 }

lfo3It :: Number -&gt; Number
lfo3It = lfo { phase: pi, amp: 2.0, freq: 16.0 }

squareRootIt :: Number -&gt; Number
squareRootIt = flip pow 0.5

squareIt :: Number -&gt; Number
squareIt = flip pow 0.5

clipIt :: Number -&gt; Number
clipIt = max 0.0 &lt;&lt;&lt; min 1.0

main :: Player
main = player
  $ note_
      ( Volume $
          foldl (&lt;&lt;&lt;) identity
            [ clipIt
            , lfo3It
            , squareRootIt
            , lfo2It
            , squareIt
            , lfo1It
            ]
      )
      longest
      c3
</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Foldable (foldl)
import Math (pi, pow)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

lfo1It :: Number -&gt; Number
lfo1It = lfo { phase: 0.0, amp: 0.3, freq: 4.0 }

lfo2It :: Number -&gt; Number
lfo2It = lfo { phase: pi, amp: 2.0, freq: 8.0 }

lfo3It :: Number -&gt; Number
lfo3It = lfo { phase: pi, amp: 2.0, freq: 16.0 }

squareRootIt :: Number -&gt; Number
squareRootIt = flip pow 0.5

squareIt :: Number -&gt; Number
squareIt = flip pow 0.5

clipIt :: Number -&gt; Number
clipIt = max 0.0 &lt;&lt;&lt; min 1.0

main :: Player
main = player
  $ note_
      ( Volume $
          foldl (&lt;&lt;&lt;) identity
            [ clipIt
            , lfo3It
            , squareRootIt
            , lfo2It
            , squareIt
            , lfo1It
            ]
      )
      longest
      c3
</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>The function <a href="https://pursuit.purescript.org/packages/purescript-prelude/5.0.1/docs/Control.Category#t:Category"><code>identity</code></a> is my favorite function. It comes up time and time again in functional programming through its central role in <a href="https://bartoszmilewski.com/2014/10/28/category-theory-for-programmers-the-preface/">Category theory</a>. We&#x27;ll see it again when we make music using the <a href="https://bartoszmilewski.com/2015/09/01/the-yoneda-lemma/">Yoneda lemma</a>. There are lots of neat tricks you can do with identity, including omitting it enitrely in certain forumlations. In the example below, which sounds exactly like the example above, we exploit the fact that identity <em>is</em> the identity in the set of endo functions (meaning that it is the endofunction that, when composed with an endofunction, will return the original).</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Foldable (fold)
import Data.Monoid.Endo (Endo(..))
import Data.Newtype (unwrap)
import Math (pi, pow)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

lfo1It :: Number -&gt; Number
lfo1It = lfo { phase: 0.0, amp: 0.3, freq: 4.0 }

lfo2It :: Number -&gt; Number
lfo2It = lfo { phase: pi, amp: 2.0, freq: 8.0 }

lfo3It :: Number -&gt; Number
lfo3It = lfo { phase: pi, amp: 2.0, freq: 16.0 }

squareRootIt :: Number -&gt; Number
squareRootIt = flip pow 0.5

squareIt :: Number -&gt; Number
squareIt = flip pow 0.5

clipIt :: Number -&gt; Number
clipIt = max 0.0 &lt;&lt;&lt; min 1.0

main :: Player
main = player
  $ note_
      ( Volume
          $ unwrap
          $ fold
          $ map Endo
              [ clipIt
              , lfo3It
              , squareRootIt
              , lfo2It
              , squareIt
              , lfo1It
              ]
      )
      longest
      c3
</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Foldable (fold)
import Data.Monoid.Endo (Endo(..))
import Data.Newtype (unwrap)
import Math (pi, pow)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

lfo1It :: Number -&gt; Number
lfo1It = lfo { phase: 0.0, amp: 0.3, freq: 4.0 }

lfo2It :: Number -&gt; Number
lfo2It = lfo { phase: pi, amp: 2.0, freq: 8.0 }

lfo3It :: Number -&gt; Number
lfo3It = lfo { phase: pi, amp: 2.0, freq: 16.0 }

squareRootIt :: Number -&gt; Number
squareRootIt = flip pow 0.5

squareIt :: Number -&gt; Number
squareIt = flip pow 0.5

clipIt :: Number -&gt; Number
clipIt = max 0.0 &lt;&lt;&lt; min 1.0

main :: Player
main = player
  $ note_
      ( Volume
          $ unwrap
          $ fold
          $ map Endo
              [ clipIt
              , lfo3It
              , squareRootIt
              , lfo2It
              , squareIt
              , lfo1It
              ]
      )
      longest
      c3
</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><h2>Scales</h2><p>Armed with our composition skills, we can approach pitch in the same way that we approached volume.  Before we do, though, it&#x27;d be useful to talk a bit about the scales along which we perceive pitch and volume. While one can be plenty creative without knowing these scales, mastering them makes it easier to anticipate how music will be heard in certain cultural contexts.</p><p>In the previous example, when we were linearly changing volume between 0 and 1, the change from <code>0.0-0.5</code> was <em>much</em> greater than the change from <code>0.5-1.0</code>. Let&#x27;s confirm that by using the example below. Switch between the functions <code>firstHalf</code> and <code>secondHalf</code> to hear the difference.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Math (calcSlope)
import WAGS.Lib.Tidal.Tidal (betwixt)

firstHalf :: Number -&gt; Number
firstHalf = betwixt 0.0 0.5 &lt;&lt;&lt; calcSlope 0.0 0.0 5.0 0.5

secondHalf :: Number -&gt; Number
secondHalf = betwixt 0.5 1.0 &lt;&lt;&lt; calcSlope 0.0 0.5 5.0 1.0

main :: Player
main = player (note_ (Volume firstHalf) longest c4)</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Lib.Learn.Note (note_)
import WAGS.Math (calcSlope)
import WAGS.Lib.Tidal.Tidal (betwixt)

firstHalf :: Number -&gt; Number
firstHalf = betwixt 0.0 0.5 &lt;&lt;&lt; calcSlope 0.0 0.0 5.0 0.5

secondHalf :: Number -&gt; Number
secondHalf = betwixt 0.5 1.0 &lt;&lt;&lt; calcSlope 0.0 0.5 5.0 1.0

main :: Player
main = player (note_ (Volume firstHalf) longest c4)</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>This is because, when we scale the amplitude of a signal linearly, we hear that change <em>logarithmically</em>. The unit for logarithmic amplitude is the <strong>bel</strong>, and in almsot all literature on sound, you&#x27;ll hear folks talking about tenths of bels, or <strong>decibels</strong> (dB for short).  Below is a chart that shows loudness (amplitude ratio) descending from 1 to 0, and the corresponding change in decibels, and how we effectively hear it (the power ratio).</p><table><thead><tr><th style="text-align:center">dB</th><th style="text-align:center">Power ratio</th><th style="text-align:center">Amplitude ratio</th></tr></thead><tbody><tr><td>0</td><td>1</td><td>1</td></tr><tr><td>−1</td><td>0 .794</td><td>0 .891</td></tr><tr><td>−3</td><td>0 .501 ≈ 1⁄2</td><td>0 .708 ≈ √1⁄2</td></tr><tr><td>−6</td><td>0 .251 ≈ 1⁄4</td><td>0 .501 ≈ 1⁄2</td></tr><tr><td>−10</td><td>0 .1</td><td>0 .3162</td></tr><tr><td>−20</td><td>0 .01</td><td>0 .1</td></tr><tr><td>−30</td><td>0 .001</td><td>0 .03162</td></tr><tr><td>−40</td><td>0 .0001</td><td>0 .01</td></tr><tr><td>−50</td><td>0 .00001</td><td>0 .003162</td></tr><tr><td>−60</td><td>0 .000001</td><td>0 .001</td></tr><tr><td>−70</td><td>0 .0000001</td><td>0 .0003162</td></tr><tr><td>−80</td><td>0 .00000001</td><td>0 .0001</td></tr><tr><td>−90</td><td>0 .000000001</td><td>0 .00003162</td></tr><tr><td>−100</td><td>0 .0000000001</td><td>0 .00001</td></tr></tbody></table><p>We can bring this even closer to human perception using <a href="https://en.wikipedia.org/wiki/Equal-loudness_contour">Fletcher-Munson curves</a>, also known as equal-loudness contours. This adds ripples into our logarithmic model that represent the ideosyncracies of human hearing. Many sensible defaults in industry-grade automatic equalization and mastering software are based on these curves.</p><p><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/4/47/Lindos1.svg/668px-Lindos1.svg.png" alt="Fletcher-Munson curves"/></p><p>Pitch also exists on many different scales, and depending on our choice of scale, we can have radically different musical outocmes that are evokative of cultures that span the globe. When we use notes like <code>c4</code> or <code>aFlat3</code>, we draw them from a scale called the equally-tempered chromatic scale. This scale became standardized in Europe in the 18th century and is currently the basis of most popular music.  The equally-tempered scale is also a logarithmic one: we perceive two pitches to be of the same class when based on powers of 2. For example, most people hear 220.0 (<code>220 * 2 ^ 0</code>), 440.0 (<code>220 * 2 ^ 1</code>), 880.0 (<code>220 * 2 ^ 2</code>) and 1760.0 (<code>220 * 2 ^ 3</code>) as the same note shifted higher and higher.  Let&#x27;s use that as a point of departure for our first exmaple on pitch.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import Math ((%))
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (mezzoForte)
import WAGS.Lib.Learn.Note (note_)

jumpy :: Number -&gt; Number
jumpy t =
  let
    time = t % 1.0
    out
      | time &lt; 0.25 = 220.0
      | time &lt; 0.5 = 440.0
      | time &lt; 0.75 = 880.0
      | otherwise = 1760.0
  in
    out

main :: Player
main = player (note_ mezzoForte longest (Pitch jumpy))</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import Math ((%))
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Pitch
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Volume (mezzoForte)
import WAGS.Lib.Learn.Note (note_)

jumpy :: Number -&gt; Number
jumpy t =
  let
    time = t % 1.0
    out
      | time &lt; 0.25 = 220.0
      | time &lt; 0.5 = 440.0
      | time &lt; 0.75 = 880.0
      | otherwise = 1760.0
  in
    out

main :: Player
main = player (note_ mezzoForte longest (Pitch jumpy))</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><h2>Pitch</h2><p>All of the same functions we used to control volume can also be used to control the pitch of our single note. In the example below, the same <code>base</code> function is scaled to appropriate ranges for each parameter. Again, we&#x27;ll use composition (<code>&lt;&lt;&lt;</code>) for this.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude
import WAGS.Lib.Learn.Pitch
import Math (pi)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Math (calcSlope)

type FofTime = Number -&gt; Number

driver1 :: FofTime
driver1 = lfo { phase: 0.0, amp: 2.0, freq: 1.0 }

freq1 :: FofTime
freq1 = lfo { phase: 0.0, amp: 1.0, freq: 2.0 }

driver2 :: FofTime
driver2 = lfo { phase: 0.0, amp: 1.5, freq: 0.25 }

freq2 :: FofTime
freq2 = lfo { phase: pi, amp: 1.0, freq: 1.0 }

base :: FofTime
base = add &lt;$&gt; (freq1 &lt;&lt;&lt; driver1) &lt;*&gt; (freq2 &lt;&lt;&lt; driver2)

vol :: FofTime
vol = min 1.0 &lt;&lt;&lt; mul 0.6 &lt;&lt;&lt; max 0.0 &lt;&lt;&lt; base

pitch :: FofTime
pitch = calcSlope (-1.0) 220.0 1.0 800.0 &lt;&lt;&lt; base

main :: Player
main = player (note_ (Volume vol) longest (Pitch pitch))</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude
import WAGS.Lib.Learn.Pitch
import Math (pi)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))
import WAGS.Math (calcSlope)

type FofTime = Number -&gt; Number

driver1 :: FofTime
driver1 = lfo { phase: 0.0, amp: 2.0, freq: 1.0 }

freq1 :: FofTime
freq1 = lfo { phase: 0.0, amp: 1.0, freq: 2.0 }

driver2 :: FofTime
driver2 = lfo { phase: 0.0, amp: 1.5, freq: 0.25 }

freq2 :: FofTime
freq2 = lfo { phase: pi, amp: 1.0, freq: 1.0 }

base :: FofTime
base = add &lt;$&gt; (freq1 &lt;&lt;&lt; driver1) &lt;*&gt; (freq2 &lt;&lt;&lt; driver2)

vol :: FofTime
vol = min 1.0 &lt;&lt;&lt; mul 0.6 &lt;&lt;&lt; max 0.0 &lt;&lt;&lt; base

pitch :: FofTime
pitch = calcSlope (-1.0) 220.0 1.0 800.0 &lt;&lt;&lt; base

main :: Player
main = player (note_ (Volume vol) longest (Pitch pitch))</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>When working with pitch, it&#x27;s often useful to use notes from a scale like <code>c4</code> or <code>d5</code>. In addition, we can transpose notes by adding intervals. Let&#x27;s see an example that modulates transposition based on time. Another interesting aspect of this example is that pitch no longer <em>contains</em> a function of time (no more <code>Pitch (\t -&gt; f t)</code>), but rather a function of time is used to <em>produce</em> a <code>Pitch</code> (something isomorphic to <code>\t -&gt; Pitch (f t)</code>). We can distribute <code>time</code> from the outside to the inside of pitch using the function <a href="https://pursuit.purescript.org/packages/purescript-prelude/5.0.1/docs/Control.Bind#v:join"><code>join</code></a> — a function we&#x27;ll explore deeper when we look at <a href="https://pursuit.purescript.org/packages/purescript-prelude/5.0.1/docs/Control.Monad#t:Monad">monads</a>.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Newtype (unwrap, wrap)
import Math ((%), pi)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

type FofTime = Number -&gt; Number

toPitch :: (Number -&gt; Pitch ((-&gt;) Number)) -&gt; Pitch ((-&gt;) Number)
toPitch = wrap &lt;&lt;&lt; join &lt;&lt;&lt; map unwrap

beat :: FofTime
beat = max 0.0 &lt;&lt;&lt; lfo { phase: 0.5 * pi, amp: 0.75, freq: 8.0 }

chord :: Number -&gt; Pitch ((-&gt;) Number)
chord t =
  let
    time = t % 1.0
    out
      | time &lt; 0.25 = c4
      | time &lt; 0.5 = eFlat4
      | time &lt; 0.75 = fSharp4
      | otherwise = a4
  in
    out

transposition :: Number -&gt; Pitch ((-&gt;) Number)
transposition t =
  let
    time = t % 6.0
    out
      | time &lt; 1.0 = minorThird
      | time &lt; 2.0 = augmentedFourth
      | time &lt; 3.0 = majorSixth
      | time &lt; 4.0 = octave
      | time &lt; 5.0 = majorSixth
      | otherwise = augmentedFourth
  in
    out

main :: Player
main = player $
  note_
    (Volume beat)
    longest
    (toPitch (add &lt;$&gt; chord &lt;*&gt; transposition))</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Newtype (unwrap, wrap)
import Math ((%), pi)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

type FofTime = Number -&gt; Number

toPitch :: (Number -&gt; Pitch ((-&gt;) Number)) -&gt; Pitch ((-&gt;) Number)
toPitch = wrap &lt;&lt;&lt; join &lt;&lt;&lt; map unwrap

beat :: FofTime
beat = max 0.0 &lt;&lt;&lt; lfo { phase: 0.5 * pi, amp: 0.75, freq: 8.0 }

chord :: Number -&gt; Pitch ((-&gt;) Number)
chord t =
  let
    time = t % 1.0
    out
      | time &lt; 0.25 = c4
      | time &lt; 0.5 = eFlat4
      | time &lt; 0.75 = fSharp4
      | otherwise = a4
  in
    out

transposition :: Number -&gt; Pitch ((-&gt;) Number)
transposition t =
  let
    time = t % 6.0
    out
      | time &lt; 1.0 = minorThird
      | time &lt; 2.0 = augmentedFourth
      | time &lt; 3.0 = majorSixth
      | time &lt; 4.0 = octave
      | time &lt; 5.0 = majorSixth
      | otherwise = augmentedFourth
  in
    out

main :: Player
main = player $
  note_
    (Volume beat)
    longest
    (toPitch (add &lt;$&gt; chord &lt;*&gt; transposition))</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>Interestingly, we see that when we <em>add</em> an octave to a pitch, this has the effect of <em>multiplying</em> it by 2. This is because <code>Pitch</code> adheres to a different meaning of <code>add</code> and <code>mul</code> than <code>Number</code>.  In functional programming, the behavior of operators like <code>add</code> and <code>mul</code> can vary from type to type so long as they follow certain predefined laws. For addition and multiplcation, the laws in question are those of the <a href="https://en.wikipedia.org/wiki/Semiring">Semiring</a>. Here is how they&#x27;re defined in <code>wags-lib</code>.</p><deckgo-highlight-code language="haskell">
          <code slot="code">cpsToMidi&#x27; :: Number -&gt; Number
cpsToMidi&#x27; i = (log (i / 440.0) / log 2.0) * 12.0 + 69.0

midiToCps&#x27; :: Number -&gt; Number
midiToCps&#x27; i = 440.0 * (2.0 `pow` ((i - 69.0) / 12.0))

instance semiringPitch :: Applicative f =&gt; Semiring (Pitch f) where
  zero = Pitch (pure zero)
  one = Pitch (pure one)
  add (Pitch a) (Pitch b) = Pitch (midiToCps&#x27; &lt;$&gt;
    (add &lt;$&gt; (cpsToMidi&#x27; &lt;$&gt; a) &lt;*&gt; (cpsToMidi&#x27; &lt;$&gt; b)))
  mul (Pitch a) (Pitch b) = Pitch (midiToCps&#x27; &lt;$&gt;
    (mul &lt;$&gt; (cpsToMidi&#x27; &lt;$&gt; a) &lt;*&gt; (cpsToMidi&#x27; &lt;$&gt; b)))</code>
        </deckgo-highlight-code><p>Are these definitions in fact lawful? Let&#x27;s test them out in music! In functional programming, when we <a href="https://pursuit.purescript.org/packages/purescript-quickcheck-laws/6.0.1">test laws</a>, we usually use a library called <a href="https://pursuit.purescript.org/packages/purescript-quickcheck/7.1.0">QuickCheck</a> to generate a bunch of random examples, which we&#x27;ll do here. In each example, we&#x27;ll hear pairs of notes in series, and if the pairs are always the same, the law holds!</p><h3>Law 1 — Addition is commutative</h3><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Function (on)
import Data.Array.NonEmpty (fromNonEmpty)
import Data.FunctorWithIndex (mapWithIndex)
import Data.Int (toNumber)
import Data.Lens (view, over, _1, _2)
import Data.List (List(..), length, sortBy, (:))
import Data.Newtype (unwrap, wrap)
import Data.NonEmpty ((:|))
import Data.Profunctor (dimap)
import Data.Traversable (sequence)
import Data.Tuple.Nested (type (/\), (/\))
import Data.Unfoldable (replicate)
import Math ((%))
import Test.QuickCheck (mkSeed)
import Test.QuickCheck.Gen (Gen, elements, evalGen)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

type PitchI = Pitch ((-&gt;) Number)
type FofTime = Number -&gt; Number

toPitch :: (Number -&gt; Pitch ((-&gt;) Number)) -&gt; Pitch ((-&gt;) Number)
toPitch = wrap &lt;&lt;&lt; join &lt;&lt;&lt; map unwrap

beat :: FofTime
beat = max 0.0 &lt;&lt;&lt; lfo { phase: 0.0, amp: 0.75, freq: 8.0 }

aPitch :: Gen PitchI
aPitch = elements $ fromNonEmpty
  $ c0 :| [ cSharp0, d0, eFlat0, e0, f0, fSharp0, g0, aFlat0, a0, bFlat0, b0 ]

law1 :: Gen (PitchI /\ PitchI)
law1 = do
  a &lt;- aPitch
  b &lt;- aPitch
  c &lt;- aPitch
  pure $ (a + (b + c)) /\ ((a + b) + c)

bigGuard :: List (Number /\ PitchI) -&gt; PitchI -&gt; Number -&gt; PitchI
bigGuard Nil default _ = default
bigGuard ((a /\ b) : c) default time
  | time &lt; a = b
  | otherwise = bigGuard c default time

gap = 0.25 :: Number

pitches :: List (Number /\ PitchI)
pitches = sortBy (compare `on` view _1) (left &lt;&gt; right)
  where
  orig = evalGen
    (sequence $ replicate 100 law1)
    ({ newSeed: mkSeed 0, size: 10 })
  mapped x f = map (over _1 x)
    $ mapWithIndex
        (dimap ((/\) &lt;&lt;&lt; toNumber) ((map &lt;&lt;&lt; map) (view f)) ($))
        orig
  left = mapped (add gap &lt;&lt;&lt; mul gap &lt;&lt;&lt; mul 2.0) _1
  right = mapped (add gap &lt;&lt;&lt; mul gap &lt;&lt;&lt; add 1.0 &lt;&lt;&lt; mul 2.0) _2

main :: Player
main = player
  $ note_ (Volume beat) longest
  $ toPitch
  $ compose (bigGuard pitches c4)
      (flip (%) (toNumber (length pitches) * gap))</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Function (on)
import Data.Array.NonEmpty (fromNonEmpty)
import Data.FunctorWithIndex (mapWithIndex)
import Data.Int (toNumber)
import Data.Lens (view, over, _1, _2)
import Data.List (List(..), length, sortBy, (:))
import Data.Newtype (unwrap, wrap)
import Data.NonEmpty ((:|))
import Data.Profunctor (dimap)
import Data.Traversable (sequence)
import Data.Tuple.Nested (type (/\), (/\))
import Data.Unfoldable (replicate)
import Math ((%))
import Test.QuickCheck (mkSeed)
import Test.QuickCheck.Gen (Gen, elements, evalGen)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

type PitchI = Pitch ((-&gt;) Number)
type FofTime = Number -&gt; Number

toPitch :: (Number -&gt; Pitch ((-&gt;) Number)) -&gt; Pitch ((-&gt;) Number)
toPitch = wrap &lt;&lt;&lt; join &lt;&lt;&lt; map unwrap

beat :: FofTime
beat = max 0.0 &lt;&lt;&lt; lfo { phase: 0.0, amp: 0.75, freq: 8.0 }

aPitch :: Gen PitchI
aPitch = elements $ fromNonEmpty
  $ c0 :| [ cSharp0, d0, eFlat0, e0, f0, fSharp0, g0, aFlat0, a0, bFlat0, b0 ]

law1 :: Gen (PitchI /\ PitchI)
law1 = do
  a &lt;- aPitch
  b &lt;- aPitch
  c &lt;- aPitch
  pure $ (a + (b + c)) /\ ((a + b) + c)

bigGuard :: List (Number /\ PitchI) -&gt; PitchI -&gt; Number -&gt; PitchI
bigGuard Nil default _ = default
bigGuard ((a /\ b) : c) default time
  | time &lt; a = b
  | otherwise = bigGuard c default time

gap = 0.25 :: Number

pitches :: List (Number /\ PitchI)
pitches = sortBy (compare `on` view _1) (left &lt;&gt; right)
  where
  orig = evalGen
    (sequence $ replicate 100 law1)
    ({ newSeed: mkSeed 0, size: 10 })
  mapped x f = map (over _1 x)
    $ mapWithIndex
        (dimap ((/\) &lt;&lt;&lt; toNumber) ((map &lt;&lt;&lt; map) (view f)) ($))
        orig
  left = mapped (add gap &lt;&lt;&lt; mul gap &lt;&lt;&lt; mul 2.0) _1
  right = mapped (add gap &lt;&lt;&lt; mul gap &lt;&lt;&lt; add 1.0 &lt;&lt;&lt; mul 2.0) _2

main :: Player
main = player
  $ note_ (Volume beat) longest
  $ toPitch
  $ compose (bigGuard pitches c4)
      (flip (%) (toNumber (length pitches) * gap))</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><h3>Law 2 — Multiplication is distributive</h3><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Lens (view, over, _1, _2)
import Data.Array.NonEmpty (fromNonEmpty)
import Data.FunctorWithIndex (mapWithIndex)
import Data.Int (toNumber)
import Data.Function (on)
import Data.List (List(..), sortBy, length, (:))
import Data.Newtype (unwrap, wrap)
import Data.NonEmpty ((:|))
import Data.Profunctor (dimap)
import Data.Traversable (sequence)
import Data.Tuple.Nested (type (/\), (/\))
import Data.Unfoldable (replicate)
import Math ((%))
import Test.QuickCheck (mkSeed)
import Test.QuickCheck.Gen (Gen, elements, evalGen)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

type PitchI = Pitch ((-&gt;) Number)
type FofTime = Number -&gt; Number

toPitch :: (Number -&gt; Pitch ((-&gt;) Number)) -&gt; Pitch ((-&gt;) Number)
toPitch = wrap &lt;&lt;&lt; join &lt;&lt;&lt; map unwrap

beat :: FofTime
beat = max 0.0 &lt;&lt;&lt; lfo { phase: 0.0, amp: 0.75, freq: 8.0 }

aMult :: Gen PitchI
aMult = elements $ fromNonEmpty $ semitone :| [ wholeTone, minorThird, majorThird ]

aPitch :: Gen PitchI
aPitch = elements $ fromNonEmpty
  $ c0 :| [ cSharp0, d0, eFlat0, e0, f0, fSharp0, g0, aFlat0, a0, bFlat0, b0 ]

law2 :: Gen (PitchI /\ PitchI)
law2 = do
  a &lt;- aMult
  b &lt;- aPitch
  c &lt;- aPitch
  pure $ (a * (b + c)) /\ (a * b + a * c)

bigGuard :: List (Number /\ PitchI) -&gt; PitchI -&gt; Number -&gt; PitchI
bigGuard Nil default _ = default
bigGuard ((a /\ b) : c) default time
  | time &lt; a = b
  | otherwise = bigGuard c default time

gap = 0.25 :: Number

pitches :: List (Number /\ PitchI)
pitches = sortBy (compare `on` view _1) (left &lt;&gt; right)
  where
  orig = evalGen
    (sequence $ replicate 100 law2)
    ({ newSeed: mkSeed 0, size: 10 })
  mapped x f = map (over _1 x)
    $ mapWithIndex
        (dimap ((/\) &lt;&lt;&lt; toNumber) ((map &lt;&lt;&lt; map) (view f)) ($))
        orig
  left = mapped (mul gap &lt;&lt;&lt; mul 2.0) _1
  right = mapped (mul gap &lt;&lt;&lt; add 1.0 &lt;&lt;&lt; mul 2.0) _2

main :: Player
main = player
  $ note_ (Volume beat) longest
  $ toPitch
  $ compose (bigGuard pitches c4)
      (flip (%) (toNumber (length pitches) * gap))</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.Lens (view, over, _1, _2)
import Data.Array.NonEmpty (fromNonEmpty)
import Data.FunctorWithIndex (mapWithIndex)
import Data.Int (toNumber)
import Data.Function (on)
import Data.List (List(..), sortBy, length, (:))
import Data.Newtype (unwrap, wrap)
import Data.NonEmpty ((:|))
import Data.Profunctor (dimap)
import Data.Traversable (sequence)
import Data.Tuple.Nested (type (/\), (/\))
import Data.Unfoldable (replicate)
import Math ((%))
import Test.QuickCheck (mkSeed)
import Test.QuickCheck.Gen (Gen, elements, evalGen)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

type PitchI = Pitch ((-&gt;) Number)
type FofTime = Number -&gt; Number

toPitch :: (Number -&gt; Pitch ((-&gt;) Number)) -&gt; Pitch ((-&gt;) Number)
toPitch = wrap &lt;&lt;&lt; join &lt;&lt;&lt; map unwrap

beat :: FofTime
beat = max 0.0 &lt;&lt;&lt; lfo { phase: 0.0, amp: 0.75, freq: 8.0 }

aMult :: Gen PitchI
aMult = elements $ fromNonEmpty $ semitone :| [ wholeTone, minorThird, majorThird ]

aPitch :: Gen PitchI
aPitch = elements $ fromNonEmpty
  $ c0 :| [ cSharp0, d0, eFlat0, e0, f0, fSharp0, g0, aFlat0, a0, bFlat0, b0 ]

law2 :: Gen (PitchI /\ PitchI)
law2 = do
  a &lt;- aMult
  b &lt;- aPitch
  c &lt;- aPitch
  pure $ (a * (b + c)) /\ (a * b + a * c)

bigGuard :: List (Number /\ PitchI) -&gt; PitchI -&gt; Number -&gt; PitchI
bigGuard Nil default _ = default
bigGuard ((a /\ b) : c) default time
  | time &lt; a = b
  | otherwise = bigGuard c default time

gap = 0.25 :: Number

pitches :: List (Number /\ PitchI)
pitches = sortBy (compare `on` view _1) (left &lt;&gt; right)
  where
  orig = evalGen
    (sequence $ replicate 100 law2)
    ({ newSeed: mkSeed 0, size: 10 })
  mapped x f = map (over _1 x)
    $ mapWithIndex
        (dimap ((/\) &lt;&lt;&lt; toNumber) ((map &lt;&lt;&lt; map) (view f)) ($))
        orig
  left = mapped (mul gap &lt;&lt;&lt; mul 2.0) _1
  right = mapped (mul gap &lt;&lt;&lt; add 1.0 &lt;&lt;&lt; mul 2.0) _2

main :: Player
main = player
  $ note_ (Volume beat) longest
  $ toPitch
  $ compose (bigGuard pitches c4)
      (flip (%) (toNumber (length pitches) * gap))</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>Indeed, we hear that the addition of pitch commutes — <code>a + (b + c) = (a + b) + c</code>. Furthermore, multiplication distributes: <code>a * (b + c) = a * b + a * c</code>. The abiltiy to define custom behavior of functions on types based on laws is a core feature of most programming languages in the <a href="https://en.wikipedia.org/wiki/ML_(programming_language)">ML-family</a>, including <a href="https://haskell.org">Haskell</a>, <a href="https://idris-lang.org">Idris</a>, and of course <a href="https://purescript.org"><code>PureScript</code></a>. The fact that a single function operates differently on different types according to an underlying law is a deeply musical idea. It is the essence of a <em>theme</em> or <em>motif</em>: something that can <a href="http://websites.umich.edu/~umfandsf/symbolismproject/symbolism.html/Teutonic_Mythology/wagleit.html">function differently in different contexts while retaining its identity</a>.</p><h2>I&#x27;ll be Bach</h2><p>Getting less mathy for a bit, here are the first four bars of BWV 846 transcribed using the methods we&#x27;ve covered so far.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.FunctorWithIndex (mapWithIndex)
import Data.Int (toNumber)
import Data.List (List(..), length, (:))
import Data.Newtype (unwrap, wrap)
import Data.Profunctor (lcmap)
import Data.Tuple.Nested (type (/\), (/\))
import Math ((%), pi)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

type PitchI = Pitch ((-&gt;) Number)
type FofTime = Number -&gt; Number

toPitch :: (Number -&gt; Pitch ((-&gt;) Number)) -&gt; Pitch ((-&gt;) Number)
toPitch = wrap &lt;&lt;&lt; join &lt;&lt;&lt; map unwrap

beat :: FofTime
beat = max 0.0 &lt;&lt;&lt; lfo { phase: pi, amp: 0.75, freq: 2.0 / gap }

bigGuard :: List (Number /\ PitchI) -&gt; PitchI -&gt; Number -&gt; PitchI
bigGuard Nil default _ = default
bigGuard ((a /\ b) : c) default time
  | time &lt; a = b
  | otherwise = bigGuard c default time

gap = 0.3 :: Number

pitches :: List (Number /\ PitchI)
pitches = mapWithIndex
  (lcmap ((/\) &lt;&lt;&lt; add gap &lt;&lt;&lt; mul gap &lt;&lt;&lt; toNumber) ($)) $
  c4 : e4 : g4 : c5 : e5 : g4 : c5 : e5 :
  c4 : e4 : g4 : c5 : e5 : g4 : c5 : e5 :
  c4 : d4 : a4 : d5 : f5 : a4 : d5 : f5 :
  c4 : d4 : a4 : d5 : f5 : a4 : d5 : f5 :        
  b3 : d4 : g4 : d5 : f5 : g4 : d5 : f5 :
  b3 : d4 : g4 : d5 : f5 : g4 : d5 : f5 :        
  c4 : e4 : g4 : c5 : e5 : g4 : c5 : e5 :
  c4 : e4 : g4 : c5 : e5 : g4 : c5 : e5 : Nil

main :: Player
main = player
  $ note_ (Volume beat) longest
  $ toPitch
  $ compose (bigGuard pitches c4)
      (flip (%) (toNumber (length pitches) * gap))</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude
import WAGS.Lib.Learn.Pitch

import Data.FunctorWithIndex (mapWithIndex)
import Data.Int (toNumber)
import Data.List (List(..), length, (:))
import Data.Newtype (unwrap, wrap)
import Data.Profunctor (lcmap)
import Data.Tuple.Nested (type (/\), (/\))
import Math ((%), pi)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Duration (longest)
import WAGS.Lib.Learn.Note (note_)
import WAGS.Lib.Learn.Oscillator (lfo)
import WAGS.Lib.Learn.Volume (Volume(..))

type PitchI = Pitch ((-&gt;) Number)
type FofTime = Number -&gt; Number

toPitch :: (Number -&gt; Pitch ((-&gt;) Number)) -&gt; Pitch ((-&gt;) Number)
toPitch = wrap &lt;&lt;&lt; join &lt;&lt;&lt; map unwrap

beat :: FofTime
beat = max 0.0 &lt;&lt;&lt; lfo { phase: pi, amp: 0.75, freq: 2.0 / gap }

bigGuard :: List (Number /\ PitchI) -&gt; PitchI -&gt; Number -&gt; PitchI
bigGuard Nil default _ = default
bigGuard ((a /\ b) : c) default time
  | time &lt; a = b
  | otherwise = bigGuard c default time

gap = 0.3 :: Number

pitches :: List (Number /\ PitchI)
pitches = mapWithIndex
  (lcmap ((/\) &lt;&lt;&lt; add gap &lt;&lt;&lt; mul gap &lt;&lt;&lt; toNumber) ($)) $
  c4 : e4 : g4 : c5 : e5 : g4 : c5 : e5 :
  c4 : e4 : g4 : c5 : e5 : g4 : c5 : e5 :
  c4 : d4 : a4 : d5 : f5 : a4 : d5 : f5 :
  c4 : d4 : a4 : d5 : f5 : a4 : d5 : f5 :        
  b3 : d4 : g4 : d5 : f5 : g4 : d5 : f5 :
  b3 : d4 : g4 : d5 : f5 : g4 : d5 : f5 :        
  c4 : e4 : g4 : c5 : e5 : g4 : c5 : e5 :
  c4 : e4 : g4 : c5 : e5 : g4 : c5 : e5 : Nil

main :: Player
main = player
  $ note_ (Volume beat) longest
  $ toPitch
  $ compose (bigGuard pitches c4)
      (flip (%) (toNumber (length pitches) * gap))</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>What if, before the <code>mapWithIndex</code>, you add <code>(map &lt;&lt;&lt; map) (add minorThird) $</code>?</p><h2>Deconstructing and reconstructing</h2><p>One of my favorite aspects about both music and functional programming is that anything can be a unit of construction or a subject of deconstruction. Often these two processes can happen at the same time. As a last exercise, and as a glimpse into the future, let&#x27;s again start with a &quot;single&quot; note that is comprised of six oscillators.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import WAGS.Create.Optionals (gain, sinOsc, speaker)
import WAGS.Lib.Learn (player, Player)

fundamental = 220.0 :: Number

main :: Player
main = player
  $ speaker
      { o0: gain 0.2 (sinOsc (fundamental * 1.0))
      , o1: gain 0.04 (sinOsc (fundamental * 2.0))
      , o2: gain 0.15 (sinOsc (fundamental * 3.0))
      , o3: gain 0.02 (sinOsc (fundamental * 4.0))
      , o4: gain 0.1 (sinOsc (fundamental * 5.0))
      , o5: gain 0.01 (sinOsc (fundamental * 6.0))
      }
</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import WAGS.Create.Optionals (gain, sinOsc, speaker)
import WAGS.Lib.Learn (player, Player)

fundamental = 220.0 :: Number

main :: Player
main = player
  $ speaker
      { o0: gain 0.2 (sinOsc (fundamental * 1.0))
      , o1: gain 0.04 (sinOsc (fundamental * 2.0))
      , o2: gain 0.15 (sinOsc (fundamental * 3.0))
      , o3: gain 0.02 (sinOsc (fundamental * 4.0))
      , o4: gain 0.1 (sinOsc (fundamental * 5.0))
      , o5: gain 0.01 (sinOsc (fundamental * 6.0))
      }
</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><p>Now, let&#x27;s undercut the unity of our sound by pulling it apart over time. To do this, we&#x27;ll again use LFOs, this time to subtly shift the overtones of the pitch.</p><div style="position:relative"><div style="position:absolute;top:0;z-index:1000;left:0;width:100%;opacity:1"><div style="position:relative"><div style="position:absolute;top:0;left:0;width:100%;height:100%;background-image:linear-gradient(90deg,#bdc3c7,#2c3e50)"></div><div><pre><code>module Main where

import Prelude

import WAGS.Create.Optionals (gain, sinOsc, speaker)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Oscillator (lfo)

fundamental = 220.0 :: Number

main :: Player
main = player
  $ \time -&gt; speaker
      { o0: gain
          (0.2 +
            lfo { phase: 0.0, amp: 0.1, freq: 0.2 } time)
          (sinOsc (fundamental * 1.0))
      , o1: gain
          (0.04 +
            lfo { phase: 0.0, amp: 0.02, freq: 0.3 } time)
          (sinOsc (fundamental * 2.0))
      , o2: gain
          (0.15 +
            lfo { phase: 0.0, amp: 0.1, freq: 0.4 } time)
          (sinOsc (fundamental * 3.0))
      , o3: gain
          (0.05 +
            lfo { phase: 0.0, amp: 0.04, freq: 0.5 } time)
          (sinOsc (fundamental * 4.0))
      , o4: gain
          (0.1 +
            lfo { phase: 0.0, amp: 0.09, freq: 0.6 } time)
          (sinOsc (fundamental * 5.0))
      , o5: gain
          (0.03 +
            lfo { phase: 0.0, amp: 0.02, freq: 0.7 } time)
          (sinOsc (fundamental * 6.0))
      }
</code></pre><div style="height:28px"></div></div></div></div><div><deckgo-highlight-code line-numbers="false" editable="true" language="haskell"><code slot="code">module Main where

import Prelude

import WAGS.Create.Optionals (gain, sinOsc, speaker)
import WAGS.Lib.Learn (player, Player)
import WAGS.Lib.Learn.Oscillator (lfo)

fundamental = 220.0 :: Number

main :: Player
main = player
  $ \time -&gt; speaker
      { o0: gain
          (0.2 +
            lfo { phase: 0.0, amp: 0.1, freq: 0.2 } time)
          (sinOsc (fundamental * 1.0))
      , o1: gain
          (0.04 +
            lfo { phase: 0.0, amp: 0.02, freq: 0.3 } time)
          (sinOsc (fundamental * 2.0))
      , o2: gain
          (0.15 +
            lfo { phase: 0.0, amp: 0.1, freq: 0.4 } time)
          (sinOsc (fundamental * 3.0))
      , o3: gain
          (0.05 +
            lfo { phase: 0.0, amp: 0.04, freq: 0.5 } time)
          (sinOsc (fundamental * 4.0))
      , o4: gain
          (0.1 +
            lfo { phase: 0.0, amp: 0.09, freq: 0.6 } time)
          (sinOsc (fundamental * 5.0))
      , o5: gain
          (0.03 +
            lfo { phase: 0.0, amp: 0.02, freq: 0.7 } time)
          (sinOsc (fundamental * 6.0))
      }
</code></deckgo-highlight-code><div style="display:flex;flex-direction:row;justify-content:space-between"><svg aria-hidden="true" focusable="false" data-prefix="fas" data-icon="play-circle" class="svg-inline--fa fa-play-circle fa-w-16 fa-2x " role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" style="cursor:pointer"><path fill="currentColor" d="M256 8C119 8 8 119 8 256s111 248 248 248 248-111 248-248S393 8 256 8zm115.7 272l-176 101c-15.8 8.8-35.7-2.5-35.7-21V152c0-18.4 19.8-29.8 35.7-21l176 107c16.4 9.2 16.4 32.9 0 42z"></path></svg></div></div></div><h2>Conclusion</h2><p>In this section, we learned how to use functions to shape a single note. We saw how we can compose functions to modulate a note&#x27;s volume and pitch, and we saw how to compose together several notes into one larger note that breaks apart and reforms as we listen to it. I&#x27;m pretty sure that the next article will be called <em>The Rhythm and the Functor</em>, so stay tuned for that!</p><blockquote><p><a href="https://github.com/mikesol/wagsi">Click here</a> to learn more about working with these examples on the cloud, on Windows, on Mac or on Linux. <a href="https://purescript.org">Click here</a> to learn more about the PureScript programming language, and join the Discord using<!-- --> <a href="https://purescript.org/chat">this link</a>. You&#x27;ll find me on the<!-- --> <code>#music</code> channel 🎶</p></blockquote></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'G-GZRNEZ67E8', 'auto', {});
      
      
      
      
      
      }</script><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/note-function/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-4a7f5b4f0a55e194b5d1.js"],"app":["/app-430ebca110f3a361ea83.js"],"component---src-pages-404-js":["/component---src-pages-404-js-752f857ee54bcb19e400.js"],"component---src-pages-index-mdx":["/component---src-pages-index-mdx-92121549a99e68e90f71.js"],"component---src-pages-introduction-mdx":["/component---src-pages-introduction-mdx-6069b2e1a96c164c4973.js"],"component---src-pages-note-function-mdx":["/component---src-pages-note-function-mdx-7c0b9704265813025315.js"]};/*]]>*/</script><script src="/sf/polyfill-4a7f5b4f0a55e194b5d1.js" nomodule=""></script><script src="/sf/component---src-pages-note-function-mdx-7c0b9704265813025315.js" async=""></script><script src="/sf/app-430ebca110f3a361ea83.js" async=""></script><script src="/sf/cb1608f2-b226e0f60ee15e1f6380.js" async=""></script><script src="/sf/532a2f07-688adb9b4acf536f0e77.js" async=""></script><script src="/sf/4317adae-b2dd59357a3b470e9581.js" async=""></script><script src="/sf/5f97a78d-28fbe6c0f50b244b2a9c.js" async=""></script><script src="/sf/469bb142-338af84dab33a00cd09c.js" async=""></script><script src="/sf/de3309da-22f6f90c02655d800791.js" async=""></script><script src="/sf/framework-b9deb5b1814bf6b76933.js" async=""></script><script src="/sf/webpack-runtime-89ebbb5491501f9f8d1c.js" async=""></script></body></html>